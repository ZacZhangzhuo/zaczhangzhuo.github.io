
        <!DOCTYPE html>
    <html lang="en">
    <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link rel="stylesheet" href="..\..\zMarkdownStyles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>
    8_MASdfab_Endless Wall_2.md
    </title>
    <link
        href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet"
    />
    <link rel="icon" href="../../resources/LogoIcon.png" type="image/x-icon"/>
    </head>
    <body><!-- Menu Bar --><div class="menuBar"><a href="..\..\zHome.html " class="menuBar"> <p>zHome</p></a><a href="..\..\zDesigner\zDesigner.html " class="menuBar"> <p>zDesigner</p></a><a href="..\zLearner.html " class="menuBar"> <p>zLearner</p></a><a href="..\..\zWriter\zWriter.html " class="menuBar"> <p>zWriter</p></a><a href="..\..\zPhotographer\zPhotographer.html " class="menuBar"> <p>zPhotographer</p></a><a href="..\..\zIndividualDeveloper\zIndividualDeveloper.html " class="menuBar"> <p>zIndividualDeveloper</p></a><a href="..\..\zCV.html " class="menuBar"> <p>zCV</p></a><a href="..\..\zSkills.html " class="menuBar"> <p>zSkills</p></a><a href="..\..\zContact.html " class="menuBar"> <p>zContact</p></a></div><!-- End of Menu Bar -->
    <h1 id="mas-dfab-endless-wall-2">MAS dfab - Endless Wall - 2</h1>
<h2 id="infinite-looping">Infinite looping</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">math</span>


<span class="k">def</span> <span class="nf">getZ</span><span class="p">(</span><span class="n">Plane</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Plane</span><span class="o">.</span><span class="n">Origin</span><span class="o">.</span><span class="n">Z</span>


<span class="n">Count</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">Tolerance</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="n">RemovePlanes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">TargetPlanes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Count</span><span class="p">):</span>

    <span class="c1"># for i in range(</span>
    <span class="n">listLength</span> <span class="o">=</span> <span class="mi">100000000</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Branch</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="n">listLength</span><span class="p">:</span>
            <span class="n">listLength</span> <span class="o">=</span> <span class="n">length</span>

    <span class="n">initPlanes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Branch</span><span class="p">((</span><span class="n">count</span><span class="p">)</span> <span class="o">%</span> <span class="n">Count</span><span class="p">))[:</span><span class="n">listLength</span><span class="p">]</span>
    <span class="n">theTargetPlanes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Branch</span><span class="p">((</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">Count</span><span class="p">))[:</span><span class="n">listLength</span><span class="p">]</span>

    <span class="n">iterations</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">keepPlanes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">theRemovePlanes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">initPlanes</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">theTargetPlanes</span><span class="p">):</span>
            <span class="n">iterations</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">Origin</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">Origin</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">Tolerance</span><span class="p">:</span>
                <span class="c1"># initPlanes.pop(n)</span>
                <span class="n">theTargetPlanes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">keepPlanes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">theRemovePlanes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="n">theRemovePlanes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">getZ</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">theTargetPlanes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">getZ</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">RemovePlanes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">theRemovePlanes</span><span class="p">)</span>
    <span class="n">TargetPlanes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">theTargetPlanes</span><span class="p">)</span>
</code></pre></div>

<h2 id="listen-to-the-robot">Listen to the robot</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">simple_comm</span> <span class="k">as</span> <span class="nn">comm</span>

<span class="k">if</span> <span class="n">listen</span><span class="p">:</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">listen_to_robot</span><span class="p">(</span><span class="s2">&quot;192.168.10.10&quot;</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">chunks</span><span class="p">[</span><span class="s2">&quot;actual_joints&quot;</span><span class="p">]</span>
</code></pre></div>

<h2 id="robot-position-judgement">Robot position judgement</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">scriptcontext</span> <span class="k">as</span> <span class="nn">rs</span>

<span class="n">fabricate</span> <span class="o">=</span> <span class="n">run</span>

<span class="k">if</span> <span class="n">x</span><span class="p">:</span> <span class="n">rs</span><span class="o">.</span><span class="n">sticky</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">-=</span><span class="mi">1</span>
<span class="k">if</span> <span class="n">reset</span><span class="p">:</span>
    <span class="n">rs</span><span class="o">.</span><span class="n">sticky</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">temp</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current_configuration</span><span class="p">)):</span>
    <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="n">current_configuration</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">round</span><span class="p">(</span><span class="n">stop_configuration</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">if</span> <span class="n">temp</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
    <span class="n">rs</span><span class="o">.</span><span class="n">sticky</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">fabricate</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">sticky</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
</code></pre></div>

<h2 id="sending-codes-to-the-robot">Sending codes to the robot</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">imp</span> <span class="kn">import</span> <span class="n">reload</span>
<span class="kn">import</span> <span class="nn">Rhino.Geometry</span> <span class="k">as</span> <span class="nn">rg</span>
<span class="kn">import</span> <span class="nn">simple_ur_script</span> <span class="k">as</span> <span class="nn">ur</span>
<span class="c1"># reload(ur)</span>
<span class="kn">import</span> <span class="nn">simple_comm</span> <span class="k">as</span> <span class="nn">c</span>
<span class="c1"># reload(c)</span>

<span class="k">def</span> <span class="nf">tcp</span><span class="p">(</span><span class="n">script</span><span class="p">):</span>
    <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">set_tcp_by_angles</span><span class="p">(</span><span class="n">TCP</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">TCP</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">TCP</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">TCP</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">TCP</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">TCP</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">script</span>


<span class="k">def</span> <span class="nf">set_robot_base</span><span class="p">():</span>
    <span class="n">pt_0</span> <span class="o">=</span> <span class="n">TABLE_NAVIGATION_POINTS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># base plane origin</span>
    <span class="n">pt_1</span> <span class="o">=</span> <span class="n">TABLE_NAVIGATION_POINTS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">pt_2</span> <span class="o">=</span> <span class="n">TABLE_NAVIGATION_POINTS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">robot_base</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Plane</span><span class="p">(</span><span class="n">pt_0</span><span class="p">,</span> <span class="n">pt_1</span> <span class="o">-</span> <span class="n">pt_0</span><span class="p">,</span> <span class="n">pt_2</span> <span class="o">-</span> <span class="n">pt_0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">robot_base</span>


<span class="k">def</span> <span class="nf">rhino_to_robot_space</span><span class="p">(</span><span class="n">rhino_plane</span><span class="p">):</span>
    <span class="n">plane</span> <span class="o">=</span> <span class="n">rhino_plane</span><span class="o">.</span><span class="n">Clone</span><span class="p">()</span>
    <span class="n">robot_base_plane</span> <span class="o">=</span> <span class="n">set_robot_base</span><span class="p">()</span>
    <span class="n">rhino_matrix</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Transform</span><span class="o">.</span><span class="n">PlaneToPlane</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Plane</span><span class="o">.</span><span class="n">WorldXY</span><span class="p">,</span> <span class="n">robot_base_plane</span><span class="p">)</span>
    <span class="n">plane</span><span class="o">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">rhino_matrix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plane</span>


<span class="k">def</span> <span class="nf">pickup_brick</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">pick_up_plane</span><span class="p">):</span>
    <span class="n">planes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># change the distance if needed</span>

    <span class="n">safe_plane</span> <span class="o">=</span> <span class="n">pick_up_plane</span><span class="o">.</span><span class="n">Clone</span><span class="p">()</span>
    <span class="n">safe_plane</span><span class="o">.</span><span class="n">Translate</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span> <span class="o">*</span> <span class="n">SAFE_DIST</span><span class="p">)</span>

    <span class="c1">## add to the path: go to the safe plane</span>
    <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">move_l</span><span class="p">(</span><span class="n">safe_plane</span><span class="p">,</span> <span class="n">SAFE_ROBOT_ACC</span><span class="p">,</span> <span class="n">SAFE_ROBOT_VEL</span><span class="p">)</span>
    <span class="n">planes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">safe_plane</span><span class="p">)</span>

    <span class="c1">## add to the path: go to the pick up plane</span>
    <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">move_l</span><span class="p">(</span><span class="n">pick_up_plane</span><span class="p">,</span> <span class="n">SAFE_ROBOT_ACC</span><span class="p">,</span> <span class="n">SAFE_ROBOT_VEL</span><span class="p">)</span>
    <span class="n">planes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pick_up_plane</span><span class="p">)</span>

    <span class="c1">## add to the path: turn on the vacuum and wait 1 sec.</span>
    <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">set_digital_out</span><span class="p">(</span><span class="n">IO</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SAFE_SLEEP_TIME</span><span class="p">)</span>

    <span class="c1"># add to the path: go back to the safe_plane</span>
    <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">move_l</span><span class="p">(</span><span class="n">safe_plane</span><span class="p">,</span> <span class="n">SAFE_ROBOT_ACC</span><span class="p">,</span> <span class="n">SAFE_ROBOT_VEL</span><span class="p">)</span>
    <span class="n">planes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">safe_plane</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">script</span><span class="p">,</span> <span class="n">planes</span>

<span class="k">def</span> <span class="nf">glue</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">gluePlane</span><span class="p">):</span>
    <span class="n">planes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">safeGluePlane</span> <span class="o">=</span> <span class="n">gluePlane</span><span class="o">.</span><span class="n">Clone</span><span class="p">()</span>
    <span class="n">safeGluePlane</span><span class="o">.</span><span class="n">Translate</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span> <span class="o">*</span> <span class="n">SAFE_DIST</span><span class="p">)</span>

    <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">move_l</span><span class="p">(</span><span class="n">safeGluePlane</span><span class="p">,</span> <span class="n">SAFE_ROBOT_ACC</span><span class="p">,</span> <span class="n">SAFE_ROBOT_VEL</span><span class="p">)</span>
    <span class="n">planes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">safeGluePlane</span><span class="p">)</span> 
    <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">move_l</span><span class="p">(</span><span class="n">gluePlane</span><span class="p">,</span> <span class="n">SAFE_ROBOT_ACC</span><span class="p">,</span> <span class="n">SAFE_ROBOT_VEL</span><span class="p">)</span> 
    <span class="n">planes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gluePlane</span><span class="p">)</span> 
    <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SAFE_SLEEP_TIME</span><span class="p">)</span>
    <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">move_l</span><span class="p">(</span><span class="n">safeGluePlane</span><span class="p">,</span> <span class="n">SAFE_ROBOT_ACC</span><span class="p">,</span> <span class="n">SAFE_ROBOT_VEL</span><span class="p">)</span>
    <span class="n">planes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">safeGluePlane</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">script</span><span class="p">,</span> <span class="n">planes</span>


<span class="k">def</span> <span class="nf">place_brick</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">place_plane</span><span class="p">):</span>

    <span class="n">planes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">safe_plane</span> <span class="o">=</span> <span class="n">place_plane</span><span class="o">.</span><span class="n">Clone</span><span class="p">()</span>
    <span class="n">safe_plane</span><span class="o">.</span><span class="n">Translate</span><span class="p">(</span><span class="n">rg</span><span class="o">.</span><span class="n">Vector3d</span><span class="o">.</span><span class="n">ZAxis</span> <span class="o">*</span> <span class="n">SAFE_DIST</span><span class="p">)</span>

    <span class="c1"># add to the path: go to the safe plane</span>
    <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">move_l</span><span class="p">(</span><span class="n">safe_plane</span><span class="p">,</span> <span class="n">SAFE_ROBOT_ACC</span><span class="p">,</span> <span class="n">SAFE_ROBOT_VEL</span><span class="p">)</span>
    <span class="n">planes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">safe_plane</span><span class="p">)</span>

    <span class="c1"># add to the path: go to the place plane</span>
    <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">move_l</span><span class="p">(</span><span class="n">place_plane</span><span class="p">,</span> <span class="n">SAFE_ROBOT_ACC</span><span class="p">,</span> <span class="n">SAFE_ROBOT_VEL</span><span class="p">)</span>
    <span class="n">planes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">place_plane</span><span class="p">)</span>

    <span class="c1">## add to the path: turn off the vacuum and wait 1 second (hold the brick)</span>
    <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">set_digital_out</span><span class="p">(</span><span class="n">IO</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SAFE_SLEEP_TIME</span><span class="p">)</span>
    <span class="c1"># add to the path: go back to the safe plane</span>
    <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">move_l</span><span class="p">(</span><span class="n">safe_plane</span><span class="p">,</span> <span class="n">SAFE_ROBOT_ACC</span><span class="p">,</span> <span class="n">SAFE_ROBOT_VEL</span><span class="p">)</span>
    <span class="n">planes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">safe_plane</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">script</span><span class="p">,</span> <span class="n">planes</span>

<span class="n">test_plane</span> <span class="o">=</span> <span class="n">debug_plane</span><span class="o">.</span><span class="n">Clone</span><span class="p">()</span>
<span class="c1"># the_stop_plane = stop_plane.Clone()</span>
<span class="c1"># stop_configurations.reverse()</span>

<span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="n">script</span><span class="p">):</span>
    <span class="n">script</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">concatenate_script</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">send_script</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">ROBOT_IP</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">script</span>

<span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">script</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">script</span> <span class="o">=</span> <span class="n">tcp</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>

<span class="k">if</span> <span class="n">is_debug_mode</span><span class="p">:</span>
    <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">move_l</span><span class="p">(</span><span class="n">rhino_to_robot_space</span><span class="p">(</span><span class="n">test_plane</span><span class="p">),</span> <span class="n">SAFE_ROBOT_ACC</span><span class="p">,</span> <span class="n">SAFE_ROBOT_VEL</span><span class="p">)</span>


<span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">brick_planes</span><span class="p">):</span>
        <span class="n">script</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pickup_brick</span><span class="p">(</span>
            <span class="n">script</span><span class="p">,</span> <span class="n">rhino_to_robot_space</span><span class="p">(</span><span class="n">picking_planes</span><span class="p">[</span><span class="n">count</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">picking_planes</span><span class="p">)])</span>
        <span class="p">)</span>
        <span class="n">script</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">glue</span><span class="p">(</span> <span class="n">script</span><span class="p">,</span> <span class="n">rhino_to_robot_space</span><span class="p">(</span><span class="n">gluePlane</span><span class="p">))</span>
        <span class="n">script</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">place_brick</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">rhino_to_robot_space</span><span class="p">(</span><span class="n">brick_planes</span><span class="p">[</span><span class="n">count</span><span class="p">]))</span>
        <span class="c1"># script += ur.move_l(rhino_to_robot_space(the_stop_plane), SAFE_ROBOT_ACC, SAFE_ROBOT_VEL)</span>
        <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">move_j</span><span class="p">(</span><span class="n">stop_configurations</span><span class="p">,</span> <span class="n">SAFE_ROBOT_ACC</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">SAFE_ROBOT_VEL</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">continuous_picking_planes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">continuous_brick_planes</span><span class="p">)</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">-</span>  <span class="nb">len</span><span class="p">(</span><span class="n">brick_planes</span><span class="p">)</span>

            <span class="n">script</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pickup_brick</span><span class="p">(</span>
                <span class="n">script</span><span class="p">,</span> <span class="n">rhino_to_robot_space</span><span class="p">(</span><span class="n">continuous_picking_planes</span><span class="p">[</span><span class="n">count</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">continuous_picking_planes</span><span class="p">)])</span>
            <span class="p">)</span>
            <span class="n">script</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">glue</span><span class="p">(</span> <span class="n">script</span><span class="p">,</span> <span class="n">rhino_to_robot_space</span><span class="p">(</span><span class="n">gluePlane</span><span class="p">))</span>
            <span class="n">script</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">place_brick</span><span class="p">(</span><span class="n">script</span><span class="p">,</span> <span class="n">rhino_to_robot_space</span><span class="p">(</span><span class="n">continuous_brick_planes</span><span class="p">[</span><span class="n">count</span><span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">continuous_brick_planes</span><span class="p">)]))</span>
            <span class="c1"># Zac: add to the path: go to the stop plane</span>
            <span class="c1"># script += ur.move_l(rhino_to_robot_space(the_stop_plane), SAFE_ROBOT_ACC, SAFE_ROBOT_VEL)</span>
            <span class="n">script</span> <span class="o">+=</span> <span class="n">ur</span><span class="o">.</span><span class="n">move_j</span><span class="p">(</span><span class="n">stop_configurations</span><span class="p">,</span> <span class="n">SAFE_ROBOT_ACC</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">SAFE_ROBOT_VEL</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>


<span class="k">if</span> <span class="n">fabricate</span><span class="p">:</span>
    <span class="n">send</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>
</code></pre></div>

<h2 id="simple-command-scripts">Simple command scripts</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="k">def</span> <span class="nf">concatenate_script</span><span class="p">(</span><span class="n">list_ur_commands</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal function that concatenates generated UR script into one large script file. Usually used to combine</span>
<span class="sd">    scripts generated by the GrasshopperPython components</span>

<span class="sd">    Args:</span>
<span class="sd">        list_ur_commands: A list of formatted UR Script strings</span>

<span class="sd">    Returns:</span>
<span class="sd">        ur_script: The concatenated script</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ur_script</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">def my_script():</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="c1">#ur_script += &#39;\tpopup(&quot;running my_script&quot;)\n&#39;</span>

    <span class="n">combined_script</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">ur_cmd</span> <span class="ow">in</span> <span class="n">list_ur_commands</span><span class="p">:</span>
        <span class="n">combined_script</span> <span class="o">+=</span> <span class="n">ur_cmd</span>

    <span class="c1">#format combined script</span>
    <span class="n">lines</span> <span class="o">=</span>  <span class="n">combined_script</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">ur_script</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">ur_script</span> <span class="o">+=</span> <span class="s1">&#39;end</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">ur_script</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">my_script()</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">return</span> <span class="n">ur_script</span>

<span class="k">def</span> <span class="nf">send_script</span><span class="p">(</span><span class="n">script_to_send</span><span class="p">,</span><span class="n">robot_ip</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Opens a socket to the Robot and sends a script</span>

<span class="sd">    Args:</span>
<span class="sd">        script_to_send: Script to send to socket</span>
<span class="sd">        robot_id: Integer. ID of robot</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="sd">&#39;&#39;&#39;Function that opens a socket connection to the robot&#39;&#39;&#39;</span>
    <span class="n">PORT</span> <span class="o">=</span> <span class="mi">30002</span>
    <span class="n">HOST</span> <span class="o">=</span> <span class="n">robot_ip</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Cannot connect to &quot;</span><span class="p">,</span><span class="n">HOST</span><span class="p">,</span><span class="n">PORT</span><span class="p">)</span>

    <span class="n">s</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">max_size</span><span class="o">=</span> <span class="mi">2</span><span class="o">&lt;&lt;</span><span class="mi">18</span>
    <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">script_to_send</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">&gt;</span><span class="n">max_size</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Program too long&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">script_to_send</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;failed to send&quot;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">listen_to_robot</span><span class="p">(</span><span class="n">robot_ip</span><span class="p">):</span>
    <span class="n">PORT</span> <span class="o">=</span> <span class="mi">30003</span>
    <span class="n">HOST</span> <span class="o">=</span> <span class="n">robot_ip</span>
    <span class="c1"># Create dictionary to store data</span>
    <span class="n">chunks</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">chunks</span><span class="p">[</span><span class="s2">&quot;target_joints&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">chunks</span><span class="p">[</span><span class="s2">&quot;actual_joints&quot;</span><span class="p">]</span><span class="o">=</span> <span class="p">[]</span>
    <span class="n">chunks</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">chunks</span><span class="p">[</span><span class="s2">&quot;pose&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">chunks</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>
    <span class="n">get_messages</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">chunks</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">chunks</span>

<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method that opens a TCP socket to the robot, receives data from the robot server and then closes socket</span>

<span class="sd">    Returns:</span>
<span class="sd">        data: Data broadcast by the robot. In bytes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
        <span class="nb">print</span> <span class="s2">&quot;connected&quot;</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="nb">print</span> <span class="s2">&quot;Cannot connect to &quot;</span><span class="p">,</span><span class="n">HOST</span><span class="p">,</span><span class="n">PORT</span>
    <span class="n">s</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">get_messages</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">chunks_info</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function parses data stream and selects the following information:</span>
<span class="sd">    1) q_target</span>
<span class="sd">    2) q_actual</span>
<span class="sd">    3) TCP force</span>
<span class="sd">    4) Tool Vector</span>
<span class="sd">    5) Time</span>

<span class="sd">    This data is formatted and the chunks dictionary is updated</span>
<span class="sd">    for more info see: http://wiki03.lynero.net/Technical/RealTimeClientInterface</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="c1"># get messages</span>
    <span class="n">q_target</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">60</span><span class="p">]</span>
    <span class="n">q_actual</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">[</span><span class="mi">252</span><span class="p">:</span><span class="mi">300</span><span class="p">]</span>
    <span class="n">tcp_force</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">[</span><span class="mi">540</span><span class="p">:</span><span class="mi">588</span><span class="p">]</span>
    <span class="n">tool_vector</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">[</span><span class="mi">588</span><span class="p">:</span><span class="mi">636</span><span class="p">]</span>
    <span class="n">controller_time</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">[</span><span class="mi">740</span><span class="p">:</span><span class="mi">748</span><span class="p">]</span>

    <span class="c1"># format type: int,</span>
    <span class="n">fmt_double6</span> <span class="o">=</span> <span class="s2">&quot;!dddddd&quot;</span>
    <span class="n">fmt_double1</span> <span class="o">=</span> <span class="s2">&quot;!d&quot;</span>

    <span class="c1">#Unpack selected data</span>
    <span class="n">target_joints</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">fmt_double6</span><span class="p">,</span><span class="n">q_target</span><span class="p">)</span>
    <span class="n">chunks_info</span><span class="p">[</span><span class="s2">&quot;target_joints&quot;</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">target_joints</span><span class="p">)</span>
    <span class="n">actual_joints</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">fmt_double6</span><span class="p">,</span><span class="n">q_actual</span><span class="p">)</span>
    <span class="n">chunks_info</span><span class="p">[</span><span class="s2">&quot;actual_joints&quot;</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">actual_joints</span><span class="p">)</span>
    <span class="n">forces</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">fmt_double6</span><span class="p">,</span><span class="n">tcp_force</span><span class="p">)</span>
    <span class="n">chunks_info</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">]</span><span class="o">=</span> <span class="n">forces</span>
    <span class="n">pose</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">fmt_double6</span><span class="p">,</span><span class="n">tool_vector</span><span class="p">)</span>
    <span class="n">chunks_info</span><span class="p">[</span><span class="s2">&quot;pose&quot;</span><span class="p">]</span><span class="o">=</span> <span class="n">pose</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">fmt_double1</span><span class="p">,</span><span class="n">controller_time</span><span class="p">)</span>
    <span class="n">chunks_info</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">=</span> <span class="n">time</span>
</code></pre></div>

<p><img alt="" src="8_MASdfab_Endless%20Wall_2/8_MASdfab_Endless%20Wall_2_2022-11-14-16-54-04.png" />
<img alt="" src="8_MASdfab_Endless%20Wall_2/8_MASdfab_Endless%20Wall_2_2022-11-14-16-54-26.png" /></p>
    <p class="endnotes">--- Growing, Growing, Brighter Everyday ! ---</p></body>
    </html>
    